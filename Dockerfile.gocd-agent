# Build using: docker build -f Dockerfile.gocd-agent -t gocd-agent .
FROM java:openjdk-7-jre
MAINTAINER Aravind SV <arvind.sv@gmail.com>

WORKDIR /tmp

ENV GOCD_VERSION=16.2.1-3027
ENV GOCD_AGENT_SHA1=d72f8e314499e69dfd56741a866f08cfa695def2
ENV GOCD_AGENT_URL=https://download.go.cd/binaries/${GOCD_VERSION}/deb/go-agent-${GOCD_VERSION}.deb

RUN curl -fSL $GOCD_AGENT_URL >go-agent.deb && \
  echo "$GOCD_AGENT_SHA1 go-agent.deb" | sha1sum -c - && \
  dpkg -i go-agent.deb && \
  curl -L -O https://github.com/Yelp/dumb-init/releases/download/v1.0.0/dumb-init_1.0.0_amd64.deb && \
  dpkg -i /tmp/dumb-init_* && \
  rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

ADD gocd-agent/go-agent-start.sh /usr/local/bin/go-agent

CMD ["dumb-init", "/usr/local/bin/go-agent"]
